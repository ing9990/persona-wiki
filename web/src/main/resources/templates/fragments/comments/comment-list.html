<!-- fragments/comments/comment-list.html -->
<div th:fragment="commentList" th:attr="data-last=${comments.last}">
  <div th:each="comment : ${comments.content}" class="comment-item border-b border-gray-200 py-4">
    <div class="flex">
      <div class="flex-shrink-0 mr-3">
        <img th:src="${@layoutHelper.getProfileImageByString(comment.userProfileImage)}"
             class="h-10 w-10 rounded-full object-cover"
             alt="프로필 이미지"
             onerror="this.src='/img/profile-placeholder.svg'">
      </div>

      <div class="flex-grow">
        <div class="flex items-center mb-1">
          <span class="font-medium text-gray-900 mr-2"
                th:text="${comment.userNickname != null} ? ${comment.userNickname} : '익명'"></span>
          <span class="text-sm text-gray-500"
                th:text="${comment.createdAt}"></span>
        </div>

        <div class="text-gray-700 mb-2"
             th:text="${comment.content}"></div>

        <div class="flex items-center text-sm text-gray-500">
          <button
              class="like-button requires-login flex items-center mr-8 hover:text-indigo-600 text-base"
              th:classappend="${comment.isLikedByUser} ? 'clicked text-indigo-600' : ''"
              th:attr="data-id=${comment.id}, data-figure-id=${figureId}">
            <i class="far fa-thumbs-up mr-2 text-lg"></i>
            <span class="like-count" th:text="${comment.likes}">0</span>
          </button>

          <button
              class="dislike-button requires-login flex items-center mr-8 hover:text-red-600 text-base"
              th:classappend="${comment.isDislikedByUser} ? 'clicked text-red-600' : ''"
              th:attr="data-id=${comment.id}, data-figure-id=${figureId}">
            <i class="far fa-thumbs-down mr-2 text-lg"></i>
            <span class="dislike-count" th:text="${comment.dislikes}">0</span>
          </button>

          <button
              class="add-reply-button requires-login flex items-center hover:text-indigo-600 mr-4 text-base"
              th:attr="data-id=${comment.id}">
            <i class="far fa-comment mr-2"></i>
            <span>답글</span>
          </button>

          <!-- 답글 개수 버튼 - 별도 버튼으로 분리 -->
          <button th:if="${comment.replyCount > 0}"
                  class="view-replies-btn flex items-center ml-4 text-blue-500 hover:text-blue-700 text-base"
                  th:attr="data-id=${comment.id}">
            <span class="reply-count" th:text="'답글 ' + ${comment.replyCount} + '개'">답글 0개</span>
          </button>
        </div>

        <div class="reply-container mt-3 pl-3 border-l-2 border-gray-200 hidden">
          <div class="replies-list"></div>
        </div>
      </div>
    </div>
  </div>
</div>