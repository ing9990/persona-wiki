<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="voteSection(detailsResult, current)">
  <section class="bg-white rounded-lg shadow-md p-6 mb-8 fade-in">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
      <i class="fas fa-vote-yea text-indigo-500 mr-2"></i>
      <spant> 평가</spant>
    </h2>

    <!-- 로그인 상태 -->
    <div th:if="${current.loggedIn()}">
      <!-- 이미 투표한 경우 -->
      <div th:if="${detailsResult.hasSentiment()}" class="vote-result">
        <p class="text-gray-700 mb-2">이 인물에 대해 다음과 같이 평가하셨습니다:</p>
        <div th:with="vote=${detailsResult.userVote}">
            <span th:if="${detailsResult.isPositive()}" class="vote-sentiment-badge sentiment-positive">
              <i class="fas fa-crown mr-1"></i> 숭배
            </span>
          <span th:if="${detailsResult.isNeutral()}" class="vote-sentiment-badge sentiment-neutral">
              <i class="fas fa-balance-scale mr-1"></i> 중립
            </span>
          <span th:if="${detailsResult.isNegative()}" class="vote-sentiment-badge sentiment-negative">
              <i class="fas fa-skull mr-1"></i> 사형
            </span>
        </div>
        <p class="text-sm text-gray-500 mt-3">
          <i class="fas fa-clock mr-1"></i>
          평가일: <span th:text="${#temporals.format(detailsResult.getUserVote().getCreatedAt(), 'yyyy-MM-dd HH:mm')}"></span>
        </p>
      </div>

      <!-- 아직 투표 안 한 경우 -->
      <div th:unless="${detailsResult.hasSentiment()}" class="text-gray-700 mb-4">
        <p class="mb-4">이 인물에 대한 평가를 선택해 주세요. 한 번 투표하면 변경할 수 없습니다.</p>
        <div class="grid grid-cols-3 gap-4">
          <!-- 숭배 -->
          <form th:action="@{'/' + ${detailsResult.getCategoryId()} + '/@' + ${detailsResult.getName()} + '/vote'}" method="post">
            <input type="hidden" name="sentiment" value="POSITIVE">
            <button type="submit" class="vote-button w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-green-200 hover:border-green-500 hover:bg-green-50 transition-all">
              <i class="fas fa-crown text-3xl text-green-500 mb-2"></i>
              <span class="font-bold text-lg text-green-600">숭배</span>
              <p class="text-xs text-gray-500 mt-2 text-center">이 인물은 존경받아 마땅합니다</p>
            </button>
          </form>

          <!-- 중립 -->
          <form th:action="@{'/' + ${detailsResult.getCategoryId()} + '/@' + ${detailsResult.getName()} + '/vote'}" method="post">
            <input type="hidden" name="sentiment" value="NEUTRAL">
            <button type="submit" class="vote-button w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-blue-200 hover:border-blue-500 hover:bg-blue-50 transition-all">
              <i class="fas fa-balance-scale text-3xl text-blue-500 mb-2"></i>
              <span class="font-bold text-lg text-blue-600">중립</span>
              <p class="text-xs text-gray-500 mt-2 text-center">이 인물에 대해 중립적입니다</p>
            </button>
          </form>

          <!-- 사형 -->
          <form th:action="@{'/' + ${detailsResult.getCategoryId()} + '/@' + ${detailsResult.getName()} + '/vote'}" method="post">
            <input type="hidden" name="sentiment" value="NEGATIVE">
            <button type="submit" class="vote-button w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-red-200 hover:border-red-500 hover:bg-red-50 transition-all">
              <i class="fas fa-skull text-3xl text-red-500 mb-2"></i>
              <span class="font-bold text-lg text-red-600">사형</span>
              <p class="text-xs text-gray-500 mt-2 text-center">이 인물은 비판받아 마땅합니다</p>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- 비로그인 상태 -->
    <div th:if="${current.notLoggedIn()}">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 flex flex-col sm:flex-row items-center sm:justify-between">
        <div class="flex items-center mb-2 sm:mb-0">
          <i class="fas fa-info-circle text-blue-500 text-xl mr-2"></i>
          <p class="text-gray-700 text-sm sm:text-base">
            인물에 대한 평가를 하려면 로그인이 필요합니다.
          </p>
        </div>
        <a href="/login" class="mt-2 sm:mt-0 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded transition-colors duration-200 flex items-center">
          <i class="fas fa-sign-in-alt mr-2"></i>
          로그인하기
        </a>
      </div>

      <!-- 비활성화된 버튼들 -->
      <div class="grid grid-cols-3 gap-4">
        <div class="w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed">
          <i class="fas fa-crown text-3xl text-green-400 mb-2"></i>
          <span class="font-bold text-lg text-green-500">숭배</span>
          <p class="text-xs text-gray-400 mt-2 text-center">이 인물은 존경받아 마땅합니다</p>
        </div>
        <div class="w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed">
          <i class="fas fa-balance-scale text-3xl text-blue-400 mb-2"></i>
          <span class="font-bold text-lg text-blue-500">중립</span>
          <p class="text-xs text-gray-400 mt-2 text-center">이 인물에 대해 중립적입니다</p>
        </div>
        <div class="w-full flex flex-col items-center justify-center p-6 rounded-lg border-2 border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed">
          <i class="fas fa-skull text-3xl text-red-400 mb-2"></i>
          <span class="font-bold text-lg text-red-500">사형</span>
          <p class="text-xs text-gray-400 mt-2 text-center">이 인물은 비판받아 마땅합니다</p>
        </div>
      </div>
    </div>
  </section>
</div>
</body>
</html>
