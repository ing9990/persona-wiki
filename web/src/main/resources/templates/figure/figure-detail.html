<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
  <title th:text="${detailsResult.getName()} + ' - 국민사형투표'">인물 상세</title>
  <meta name="description" th:content="${detailsResult.getBio()}">

  <link rel="stylesheet" href="/css/comment-reply.css">
  <link rel="stylesheet" href="/css/comment-style.css">
  <link rel="stylesheet" href="/css/fingure-detail.css">
</head>

<body>
<div layout:fragment="content">
  <!-- 인물 프로필 헤더 -->
  <section class="profile-header mb-8 shadow-lg" th:attr="data-figure-id=${detailsResult.getId()}">
    <img th:src="${detailsResult.getCategoryImage()}" th:alt="${detailsResult.getName()}"
         class="profile-header-image">
    <div class="profile-header-content">
      <div class="flex items-end justify-between w-full">
        <div class="flex items-end">
          <img th:src="${detailsResult.getImageUrl()}" th:alt="${detailsResult.getName()}"
               class="w-24 h-24 rounded-full profile-image object-cover mr-6"
               data-handle-error="true"
               data-placeholder="/img/profile-placeholder.svg">
          <div>
            <div class="flex items-center mb-2">
              <h1 class="text-4xl font-bold mr-3" th:text="${detailsResult.getName()}">인물 이름</h1>
              <span th:text="${detailsResult.getCategoryDisplayName()}"
                    class="badge-category text-white text-sm px-3 py-1 rounded-full">카테고리</span>
            </div>
            <p class="text-gray-200 text-lg">
              <i class="fas fa-quote-left text-sm opacity-50 mr-1"></i>
              <span th:text="${#strings.abbreviate(detailsResult.getBio(), 100)}">인물 소개 요약</span>
              <i class="fas fa-quote-right text-sm opacity-50 ml-1"></i>
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- 왼쪽: 인물 정보 -->
    <div class="lg:col-span-2">
      <!-- 인물 평가 투표 섹션 -->
      <div th:replace="fragments/vote-section :: voteSection(${detailsResult}, ${current})"></div>
      <!-- 인물 평가 투표 섹션 종료 -->

      <!-- 댓글 섹션 부분 -->
      <div
          th:replace="fragments/comment-section :: commentSection(${detailsResult}, ${current})"></div>
      <!-- 댓글 섹션 부분 종료-->
    </div>

    <!--    페이지 우측 평판 통계 부분 -->
    <div th:replace="fragments/reputation-sidebar :: reputationSidebar(${detailsResult})"></div>
    <!--    페이지 우측 평판 통계 부분 종료 -->

    <!--    페이지 우측 카테고리 섹션-->
    <div th:replace="fragments/category-section :: categorySection(${detailsResult})"></div>
    <!--    페이지 우측 카테고리 섹션 종료-->

    <!-- 공유하기 -->
    <div th:replace="fragments/share-section :: shareSection"></div>
    <!-- 공유하기 종료-->
  </div>
</div>

<th:block layout:fragment="script">
  <!-- 공통 유틸리티 -->
  <script src="/js/utils/utils.js"></script>
  <script src="/js/utils/toast-manager.js"></script>

  <!-- InfiniteScroll 라이브러리 -->
  <script src="https://unpkg.com/infinite-scroll@4/dist/infinite-scroll.pkgd.min.js"></script>
  <!-- figure-detail.html의 <th:block layout:fragment="script"> 안에 추가 -->

  <!-- 먼저 comment-api.js를 로드 -->
  <script src="/js/comment-api.js"></script>
  <script src="/js/figure/comment-infinite-scroll.js"></script>

  <!-- 추가 페이지별 스크립트 -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const figureId = document.querySelector('.profile-header').getAttribute('data-figure-id');

      console.log('Figure detail page loaded with figure ID:', figureId);

      // 공유 버튼 기능
      document.querySelectorAll('[data-action^="share-"]').forEach(button => {
        button.addEventListener('click', function (e) {
          e.preventDefault();
          const action = this.getAttribute('data-action');
          const url = window.location.href;
          const title = document.title;

          switch (action) {
            case 'share-twitter':
              window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(
                  url)}&text=${encodeURIComponent(title)}`, '_blank');
              break;
            case 'share-facebook':
              window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
                  '_blank');
              break;
            case 'share-link':
              navigator.clipboard.writeText(url).then(() => {
                alert('링크가 클립보드에 복사되었습니다.');
              });
              break;
          }
        });
      });
    });
  </script>
</th:block>
</body>
</html>